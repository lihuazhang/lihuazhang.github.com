
<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
   <meta charset="utf-8" />
   <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
   <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

   <title>Sauce OnDemand试用 - 8:00 PM at My House</title>
	
	<meta name="description" content="

  
    
       2012-04-24
        Sauce 
      
       comments
    
  
  闲着无聊，试用了下saucelabs。
先注册用户，这个略过不说。

saucelabs有两种方式:


Sauce Scout

通过访问架...">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href="" rel="alternate" title="8:00 PM at My House" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
   <meta name="robots" content="noindex, nofollow">
   <meta name="keywords" content="metro, metroui, metro-ui, metro ui, windows 8, metro style, bootstrap, framework, web framework, css, html" />
   <meta name="author" content="晋恒温"/>

   <!-- remove or comment this line if you want to use the local fonts -->
   <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700' rel='stylesheet' type='text/css'>

   <link rel="stylesheet" type="text/css" href="/bootmetro/css/bootstrap.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/bootstrap-responsive.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/bootmetro.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/bootmetro-tiles.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/metro-ui-light.css">
   <link rel="stylesheet" type="text/css" href="/bootmetro/css/icomoon.css">
   <link rel="stylesheet" type="text/css" href="/stylesheets/syntax.css">
   <link rel="stylesheet" type="text/css" href="/stylesheets/custom.css">

   <!-- All JavaScript at the bottom, except for Modernizr and Respond.
      Modernizr enables HTML5 elements & feature detects; Respond is a polyfill for min/max-width CSS3 Media Queries
      For optimal performance, use a custom Modernizr build: www.modernizr.com/download/ -->
   <script src="/scripts/modernizr-2.6.1.min.js"></script>
</head>
<!-- Prompt IE 6 users to install Chrome Frame. Remove this if you support IE 6.
     chromium.org/developers/how-tos/chrome-frame-getting-started -->
<!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->


<body>
<header id="nav-bar" class="container-fluid">
   <div class="row-fluid">
      <div class="span8">
         <div id="header-container">
            <a id="backbutton" class="win-backbutton" href ="javascript:history.go(-1);"></a>
            <h5>8:00 PM at My House</h5>
            <div class="dropdown">
               <a class="header-dropdown dropdown-toggle accent-color" data-toggle="dropdown" href="#">
                 Sauce OnDemand试用
                  <b class="caret"></b>
               </a>
               <ul class="dropdown-menu">
               	<li><a href="/archives.html">存档</a></li>
               	<li><a href="/categories.html">分类</a></li>
               <li class="divider"></li>
               <li><a href="/index.html">Home</a></li>
            </ul>
         </div>
         </div>
      </div>
      <div id="top-info" class="pull-right">
      <a href="/about_me.html" class="pull-left">
         <div id="authorname" class="top-info-block">
           <h3>晋恒温</h3>
         </div>
         <div class="top-info-block">
            <b class="icon-user"></b>
         </div>
      </a>
   </div>
</div>
</header>


<div class="container">
<article class="entry" id="/blog/sauce-ondemandshi-yong">
  <header>
    <p class="entry-meta">
      <i aria-hidden="true" class="icon-pen-alt-fill"></i> <time>2012-04-24</time>
      <i aria-hidden="true" class="icon-folder"></i> <a href="/categories.html#Sauce-ref"> Sauce </a>
      
      <i aria-hidden="true" class="icon-comments-3"></i> <a href="#comment">comments</a>
    </p>
  </header>
  <p>闲着无聊，试用了下<a href="https://saucelabs.com">saucelabs</a>。
先注册用户，这个略过不说。</p>

<p>saucelabs有两种方式:</p>

<ol>
<li><p>Sauce Scout</p>

<p>通过访问架在云端的浏览器(cloud-hosted browsers)执行测试用例。相当于saucelabs给用户提供了多种多样组合的虚拟机，只不过这个虚拟机就只有一个浏览器。如图：
<img src="/photos/soucescout.png" alt="sourcescout" title="soucescout"></p>

<p>Saucelabs提供了许多方案，对于那些没有空间部署环境的公司，这个服务的确很贴心。</p></li>
<li><p>Sauce OnDemand</p>

<p>Sauce OnDemand就是所谓的自动化了。我们利用WebDriver或者Selenium RC的remote server来指定SauceLabs提供的浏览器配置，进行各种自动化测试。</p></li>
</ol>

<p>那我们开始试用Sauce OnDemand，英语好的攻城狮们请直接移步<a href="https://saucelabs.com/docs/ondemand/getting-started/env/ruby/se2/linux">Get Started</a></p>

<p>为了方便起见，我就用ruby。首先确保你安装了<code>selenium-webdriver</code>，如果没有安装，在终端用以下命令安装：
<code>
    gem install selenium-webdriver
</code></p>

<p>输入以下代码：注意: 代码中的:url请替换成你自己的，不过我不知道这个url到底是哪里来的，
我是从get started里面的例子里找到的。</p>
<div class="highlight"><pre><code class="ruby"><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s2">&quot;test/unit&quot;</span>
<span class="nb">require</span> <span class="s1">&#39;selenium-webdriver&#39;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="o">&lt;</span> <span class="ss">Test</span><span class="p">:</span><span class="ss">:Unit</span><span class="o">::</span><span class="no">TestCase</span>
    <span class="k">def</span> <span class="nf">setup</span>
        <span class="n">caps</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">::</span><span class="ss">Remote</span><span class="p">:</span><span class="ss">:Capabilities</span><span class="o">.</span><span class="n">firefox</span>
        <span class="n">caps</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;5&quot;</span>
        <span class="n">caps</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="ss">:XP</span>
        <span class="n">caps</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Testing Selenium 2 with Ruby on Sauce&quot;</span>

        <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
          <span class="ss">:remote</span><span class="p">,</span>
          <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">&quot;http://lihuazhang:ba444e83-206c-4a9c-b008-4da920d7f852@ondemand.saucelabs.com:80/wd/hub&quot;</span><span class="p">,</span>
          <span class="ss">:desired_capabilities</span> <span class="o">=&gt;</span> <span class="n">caps</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">test_sauce</span>
        <span class="vi">@driver</span><span class="o">.</span><span class="n">navigate</span><span class="o">.</span><span class="n">to</span> <span class="s2">&quot;http://saucelabs.com/test/guinea-pig&quot;</span>
        <span class="n">assert</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;I am a page title - Sauce Labs&quot;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">teardown</span>
        <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>运行<code>ruby basic-example.rb</code></p>
<div class="highlight"><pre><code class="text">Run options: 

# Running tests:

.

Finished tests in 44.647462s, 0.0224 tests/s, 0.0224 assertions/s.

1 tests, 1 assertions, 0 failures, 0 errors, 0 skips
</code></pre></div>
<p>可以看到运行成功，我们再去sauce的<a href="https://saucelabs.com/account">Account</a>页面里去看下运行的结果。</p>

<p><img src="/photos/souceaccount.png" alt="account"></p>

<p>可以看到页面里有video和log下载，打开log我们可以看到运行的录像，而log就记录了运行的信息。
此外，我们更可以点开测试用例，查看更多的细节。</p>

<p>但是一般我们测试环境都是内网，为了满足这个条件，Saucelabs提供一条通道叫Sauce Connect。</p>

<blockquote>
<p>Sauce Connect creates a secure and reliable tunnel from our cloud to your private network that can only be accessed by you. This eliminates the need to whitelist IPs, open any ports on your firewall or go through any changes in your tests.
Sauce Connect is not only for accessing private servers. If you want all of your test traffic to be secure and reliable, even the Selenium instructions you send to Sauce, you can use Sauce Connect for that too!</p>
</blockquote>

<h2>Get Started:</h2>

<p>1.先下载<a href="https://saucelabs.com/downloads/Sauce-Connect-latest.zip">Sauce Connect</a></p>

<p>2.解压然后运行<code>java -jar Sauce-Connect.jar lihuazhang ba444e83-206c-4a9c-b008-4da920d7f852</code></p>

<ol>
<li>确定tunnel start以后，接下去你就可以运行你的测试用例了。</li>
</ol>

<p>我们再来看下刚刚那个测试用例，让程序navigate.to到本地。</p>
<div class="highlight"><pre><code class="ruby"><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s2">&quot;test/unit&quot;</span>
<span class="nb">require</span> <span class="s1">&#39;selenium-webdriver&#39;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="o">&lt;</span> <span class="ss">Test</span><span class="p">:</span><span class="ss">:Unit</span><span class="o">::</span><span class="no">TestCase</span>
    <span class="k">def</span> <span class="nf">setup</span>
        <span class="n">caps</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">::</span><span class="ss">Remote</span><span class="p">:</span><span class="ss">:Capabilities</span><span class="o">.</span><span class="n">firefox</span>
        <span class="n">caps</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;5&quot;</span>
        <span class="n">caps</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="ss">:XP</span>
        <span class="n">caps</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Testing Selenium 2 with Ruby on Sauce&quot;</span>

        <span class="vi">@driver</span> <span class="o">=</span> <span class="ss">Selenium</span><span class="p">:</span><span class="ss">:WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
          <span class="ss">:remote</span><span class="p">,</span>
          <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">&quot;http://lihuazhang:ba444e83-206c-4a9c-b008-4da920d7f852@ondemand.saucelabs.com:80/wd/hub&quot;</span><span class="p">,</span>
          <span class="ss">:desired_capabilities</span> <span class="o">=&gt;</span> <span class="n">caps</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">test_sauce</span>
        <span class="vi">@driver</span><span class="o">.</span><span class="n">navigate</span><span class="o">.</span><span class="n">to</span> <span class="s2">&quot;http://localhost:3000&quot;</span> <span class="c1"># Set a local env.</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">teardown</span>
        <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>再运行一遍，必然成功啊~</p>

<p>我们看下Sauce-Connect.jar的日志，可以看到这个tunnel起到了一个中转的作用。</p>
<div class="highlight"><pre><code class="text">2012-04-25 00:04:01,184 - connection to Sauce Connect server closed
2012-04-25 00:04:01,927 - old keepalive timer shutting down
2012-04-25 00:04:03,923 - Successful handshake with Sauce Connect server
2012-04-25 00:04:03,927 - resending 2 packets
2012-04-25 00:04:04,078 - Tunnel host version: 0.1.0, remote endpoint ID: 73b1e202231b41a3802aab8785caf15f
2012-04-25 00:05:19,002 - relative URL, constructing absolute from Host header
2012-04-25 00:05:19,003 - using constructed absolute URL: http://localhost:3000/
2012-04-25 00:05:19,007 - Could not proxy /, exception: java.net.ConnectException: Connection refused
2012-04-25 00:05:22,145 - relative URL, constructing absolute from Host header
2012-04-25 00:05:22,147 - using constructed absolute URL: http://localhost:3000/favicon.ico
2012-04-25 00:05:22,148 - Could not proxy /favicon.ico, exception: java.net.ConnectException: Connection refused
2012-04-25 00:05:22,589 - relative URL, constructing absolute from Host header
2012-04-25 00:05:22,592 - using constructed absolute URL: http://localhost:3000/favicon.ico
2012-04-25 00:05:22,594 - Could not proxy /favicon.ico, exception: java.net.ConnectException: Connection refused
2012-04-25 00:05:23,391 - GET http://feeds.bbci.co.uk/news/rss.xml?edition=int -&gt; 200 (2847ms)
2012-04-25 00:05:53,084 - disconnected from Sauce Connect server
2012-04-25 00:05:53,085 - connection to Sauce Connect server closed
</code></pre></div>
<p>同样的，我们可以在Account里面看到这个测试用例的运行细节，如图：</p>

<p><img src="/photos/sauce_detail1.png" alt="detail"></p>

<p><img src="/photos/sauce_detail2.png" alt="detail"></p>

<p>不错吧，有兴趣，自己动手试试。</p>

</article>


<section id="comment">
  <!-- Duoshuo Comment BEGIN -->
<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"jinhengwen" };
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>
<!-- Duoshuo Comment END -->


</section>



</div>



<!-- Grab Google CDN's jQuery. fall back to local if necessary -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script>window.jQuery || document.write("<script src='/scripts/jquery-1.8.2.min.js'>\x3C/script>")</script>
<script type="text/javascript" src="/scripts/jquery.mousewheel.js"></script>
<script type="text/javascript" src="/scripts/jquery.scrollTo.js"></script>
<script type="text/javascript" src="/scripts/bootstrap.min.js"></script>
<script type="text/javascript" src="/scripts/bootstrap-carousel.js"></script>
<script type="text/javascript" src="/scripts/bootmetro.js"></script>
<script type="text/javascript" src="/scripts/holder.js"></script>
<script type="text/javascript" src="/scripts/tile-slider.js"></script>
<script type="text/javascript">
$(".metro").metro();
</script>

</body>
</html>

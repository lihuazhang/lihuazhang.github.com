<!DOCTYPE html>
<html lang="zh-cn">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="恒温" />


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="八点在家">
<meta property="og:url" content="http://lihuazhang.github.io/page/3/index.html">
<meta property="og:site_name" content="八点在家">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="八点在家">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="八点在家" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">





    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>八点在家</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: false,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/images/avatar.jpeg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">恒温</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:lihuazhang@hotmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/lihuazhang" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Appium/">Appium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Metro/">Metro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebDriver/">WebDriver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/capybara/">capybara</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocos2d/">cocos2d</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cucumber/">cucumber</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gatling/">gatling</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jmeter/">jmeter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nexus-7/">nexus 7</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pageobject/">pageobject</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/">ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/">zsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/冯唐/">冯唐</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/南京/">南京</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客/">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/听来的故事/">听来的故事</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/孩子/">孩子</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/年终总结/">年终总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/恐怖/">恐怖</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/抽烟/">抽烟</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/来自qqzone/">来自qqzone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/来自wechat/">来自wechat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杭州/">杭州</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电影/">电影</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/移动测试/">移动测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/陆犯焉识/">陆犯焉识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随笔/">随笔</a></li></ul>
                    </div>
                </section>
                
                
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">恒温</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/images/avatar.jpeg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">恒温</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:lihuazhang@hotmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/lihuazhang" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-2013-09-24-fluentwait-with-webelement" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/09/24/2013-09-24-fluentwait-with-webelement/" class="article-date">
      <time datetime="2013-09-24T13:37:00.000Z" itemprop="datePublished">2013-09-24</time>
</a>

 
    <a href="/2013/09/24/2013-09-24-fluentwait-with-webelement/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2013/09/24/2013-09-24-fluentwait-with-webelement/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/09/24/2013-09-24-fluentwait-with-webelement/">FluentWait with WebElement</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><em>原文-<a href="http://seleniumsimplified.com/2012/08/22/fluentwait-with-webelement/" target="_blank" rel="external">FluentWait with WebElement</a></em></p>
<p>我在 WebDriver 上的同步策略一般都是围绕 WebDriverWait 和 自定义 ExpectedCondition 来做文章。当我第一眼看到 FluentWait，<br>我以为这是一个自定义化更多的一个 WebDriverWait。 但是当我仔细研究它的构造函数的时候，我注意到它使用了 Generics （范型）。<br>Generics 的使用意味着我不需要再传一个 WebDriver 了， 我可以使用 WebElement 或者 By 或者任何我想要的。 这样对于 Ajax 的应用，真是方便了不少。</p>
<blockquote>
<p>org.openqa.selenium.support.ui<br>Class FluentWait\<t\></t\></p>
<p>java.lang.Object<br>org.openqa.selenium.support.ui.FluentWait\<t\></t\></p>
<p>Type Parameters:<br>T - The input type for each condition used with this instance.</p>
<p>All Implemented Interfaces:<br>Wait\<t\></t\></p>
<p>Direct Known Subclasses:<br>WebDriverWait</p>
</blockquote>
<p>看下面这段代码， 我用了一个倒计时的计数器做例子。</p>
<p>这段代码实现了：</p>
<ol>
<li>用一个 WebDriverWait 等待元素出现。</li>
<li>看计数器是否倒数到 04.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">WebElement countdown = driver.findElement(By.id(<span class="string">"javascript_countdown_time"</span>));</div><div class="line"></div><div class="line"><span class="keyword">new</span> WebDriverWait(driver,<span class="number">10</span>).until(ExpectedConditions.visibilityOf(countdown));</div><div class="line"></div><div class="line"><span class="keyword">new</span> FluentWait&lt;WebElement&gt;(countdown).withTimeout(<span class="number">10</span>, TimeUnit.SECONDS).</div><div class="line">  pollingEvery(<span class="number">100</span>,TimeUnit.MILLISECONDS).</div><div class="line">    until(<span class="keyword">new</span> Function&lt;WebElement  , Boolean&gt;() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> Boolean <span class="title">apply</span><span class="params">(WebElement element)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> element.getText().endsWith(<span class="string">"04"</span>);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>注意在上述代码中，我告诉 FluentWait, apply 方法里接收的将是一个 WebElement。FluentWait 可以接受一个 Predicate 或者 Function 做为 until 方法的参。<br>我用了 Function 并在 这个 Function 里面返回一个 Boolean。</p>
<p>FluentWait 非常灵活，你可以很轻松的调整等待和轮询时间， 你也可以设置哪些 exceptions 可以忽略， 比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Waiting 30 seconds for an element to be present on the page, checking</span></div><div class="line">   <span class="comment">// for its presence once every 5 seconds.</span></div><div class="line">   Wait&lt;WebDriver&gt; wait = <span class="keyword">new</span> FluentWait&lt;WebDriver&gt;(driver)</div><div class="line">       .withTimeout(<span class="number">30</span>, SECONDS)</div><div class="line">       .pollingEvery(<span class="number">5</span>, SECONDS)</div><div class="line">       .ignoring(NoSuchElementException.class); <span class="comment">//  我们主动忽略了 NoSuchElementExceptions 的异常</span></div><div class="line"></div><div class="line">   WebElement foo = wait.until(<span class="keyword">new</span> Function&lt;WebDriver, WebElement&gt;() &#123;</div><div class="line">     <span class="function"><span class="keyword">public</span> WebElement <span class="title">apply</span><span class="params">(WebDriver driver)</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> driver.findElement(By.id(<span class="string">"foo"</span>));</div><div class="line">     &#125;</div><div class="line">   &#125;);</div></pre></td></tr></table></figure>
<p>怎样，看上去是不是优雅多了？</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebDriver/">WebDriver</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2013-09-14-gatling-shi-yong" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/09/14/2013-09-14-gatling-shi-yong/" class="article-date">
      <time datetime="2013-09-14T13:37:00.000Z" itemprop="datePublished">2013-09-14</time>
</a>

 
    <a href="/2013/09/14/2013-09-14-gatling-shi-yong/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2013/09/14/2013-09-14-gatling-shi-yong/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/09/14/2013-09-14-gatling-shi-yong/">Gatling 试用 1</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><hr>
<p>在微博上看到 <code>Gatling</code>，号称超越 <code>jmeter</code> 的性能测试工具。顿时手痒，想来个试用。</p>
<p>Gatling <em>格林机关枪</em>，看名字就恨凶悍。</p>
<p>Gatling 的动机是因为性能测试工具已经无法测试当今的应用了。</p>
<p>比如：</p>
<ol>
<li>LoadRunner 太贵了。</li>
<li>页面又改了，又要打开界面，重新录制。</li>
<li>客户说用 <code>OpenSTA</code> ， 我们只能用 windows 的虚拟机。</li>
<li>Jmeter 太弱了，并发的好假，还得建立集群，而且还不知道每个节点的信息能不能回收。。</li>
<li>Grinder 又内存泄露了，苦逼的 python 开发。。。（不知道是哪个工具）</li>
</ol>
<p>看来业界对市场上的性能测试工具都恨之入骨。</p>
<p>再来看下 Gatling：</p>
<ol>
<li><p>高效<br>Gatling 用了 actors 模型，真是一个好演员啊。</p>
<blockquote>
<p>Actor模型</p>
<p>当一个请求来了之后， 则委派给一个Actor处理， 和事件驱动的区别是， 这些Actor之间不共享任何资源， 可进行并行处理， 事件驱动模型和Actor模型很容易被搞混淆， 如果事件驱动模型来一个请求则委派一个线程去处理并且这些线程之间不共享资源，不会出现锁的问题， 则可以认为这种事件驱动模型等价于Actor模型， Scala的Actor模型就是这么处理的， Actor会被代理到线程处理， 海量的Actor会被代理到一个JVM线程池处理，这样提升了很大的效率，而这种映射是scala帮你做好了； 而Erlang中Actor模型则更加彻底， 其实是OTP实现了操作系统中的线程的功能， 这些“线程”叫做process， 只不过这些process占用的资源很少， 也不共享任何资源， 这样每个actor可以跟process一一对应</p>
</blockquote>
</li>
<li><p>Gatling 脚本是代码，而且优雅简洁</p>
<p>其实就是 scala 和 scala 写的 DSL， 不觉得 scala 优雅啊。。。</p>
</li>
<li><p>Gatling 的报表很有意义。</p>
</li>
<li><p>Gatling 免费的，明显最重要的。</p>
</li>
</ol>
<h1 id="上手"><a href="#上手" class="headerlink" title="上手"></a>上手</h1><hr>
<p>略过下载安装之类的，实在要看，自己看 <a href="https://github.com/excilys/gatling/wiki/Getting-Started" target="_blank" rel="external">Getting-started</a> 吧。<br>我们按照 <a href="https://github.com/excilys/gatling/wiki/First-Steps-with-Gatling" target="_blank" rel="external">First Steps with Gatling</a> 走一遍。<br>这个 First Steps 就是测试一个 e-banking 的应用，很可惜这个应用放在 Cloud Foundry， 国内估计访问不了。</p>
<p>这个应用的链接在：</p>
<p><a href="http://excilysbank.gatling.cloudbees.net" target="_blank" rel="external">http://excilysbank.gatling.cloudbees.net</a></p>
<p>主要实现了以下功能：</p>
<blockquote>
<ol>
<li>Session management (login, logout)</li>
<li>Accounts visualization</li>
<li>Operations visualization by month</li>
<li>Cards Operations visualization by month</li>
<li>Transfers visualization and transfer performing</li>
</ol>
</blockquote>
<h2 id="测试计划"><a href="#测试计划" class="headerlink" title="测试计划"></a>测试计划</h2><p>我们对一些具有代表性的场景进行性能测试，所以我们想象了下，用户会做的事情：</p>
<ol>
<li>用户访问应用</li>
<li>用户获得认证并登陆</li>
<li>用户访问具体的账号</li>
<li>用户查看上个月的状况</li>
<li>用户登出</li>
</ol>
<p>我们要用 Gatling 来录制这 5 个场景。</p>
<h2 id="Gatling-Recorder"><a href="#Gatling-Recorder" class="headerlink" title="Gatling Recorder"></a>Gatling Recorder</h2><p>一般工具都提供 recorder 否则就弱爆了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">~$ <span class="variable">$GATLING_HOME</span>/bin/recorder.sh</div></pre></td></tr></table></figure>
<p>启动这个脚本之后，会跳出一个类似 jmeter 的界面，我们得配置下：</p>
<ul>
<li>package: com.excilys.ebi.bank.stress</li>
<li>class name: MySimulation</li>
<li>output folder: /Users/lihuazhang/Documents/Simulation</li>
</ul>
<p><img src="/photos/gatling_gui.png" alt="alt text"></p>
<p>和 jmeter 一样， Gatling 的 recorder 一样也充当着浏览器和应用之间 proxy 的角色，从上图来看：</p>
<ul>
<li>http  8000</li>
<li>https 8001</li>
</ul>
<p>所以必须在浏览器设置代理。然后在浏览器上的所有 request 都会被记录下来。当然 Gatling 也提供了 Filters 来过滤<br>无关信息：</p>
<blockquote>
<ul>
<li>NONE: Doesn’t apply any filter one the requests, even if there are some declared;</li>
<li>EXCEPT: Allows all requests to be logged except those which filters apply on the URI;</li>
<li>ONLY: Allows only requests, which URI matches one of the filters, to be logged.</li>
</ul>
</blockquote>
<p>更加具体的，不妨看下 <a href="https://github.com/excilys/gatling/wiki/Recorder#wiki-browser-config" target="_blank" rel="external">Recorder details</a></p>
<h2 id="开始录制吧"><a href="#开始录制吧" class="headerlink" title="开始录制吧"></a>开始录制吧</h2><p>设置好代理之后，开始执行第一个场景：</p>
<ol>
<li><p>访问 <a href="http://excilysbank.gatling.cloudbees.net" target="_blank" rel="external">http://excilysbank.gatling.cloudbees.net</a></p>
</li>
<li><p>登陆</p>
<p>username = user1</p>
<p>password = password1</p>
</li>
<li><p>Click on PERSONNAL_CHECKING</p>
</li>
<li><p>Click on the previous month (for us it was November as we were in December)</p>
</li>
<li><p>Log out</p>
</li>
</ol>
<p>然后点击 Recorder 上的 stop， 就会在之前设置的 output folder 里面生成 <code>MySimulation.scala</code> 文件。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> com.excilys.ebi.bank.stress</div><div class="line"></div><div class="line"><span class="keyword">import</span> io.gatling.core.<span class="type">Predef</span>._</div><div class="line"><span class="keyword">import</span> io.gatling.core.session.<span class="type">Expression</span></div><div class="line"><span class="keyword">import</span> io.gatling.http.<span class="type">Predef</span>._</div><div class="line"><span class="keyword">import</span> io.gatling.jdbc.<span class="type">Predef</span>._</div><div class="line"><span class="keyword">import</span> io.gatling.http.<span class="type">Headers</span>.<span class="type">Names</span>._</div><div class="line"><span class="keyword">import</span> io.gatling.http.<span class="type">Headers</span>.<span class="type">Values</span>._</div><div class="line"><span class="keyword">import</span> scala.concurrent.duration._</div><div class="line"><span class="keyword">import</span> bootstrap._</div><div class="line"><span class="keyword">import</span> assertions._</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySimulation</span> <span class="keyword">extends</span> <span class="title">Simulation</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">val</span> httpProtocol = http</div><div class="line">    .baseURL(<span class="string">"http://excilysbank.gatling.cloudbees.net"</span>)</div><div class="line">    .acceptHeader(<span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>)</div><div class="line">    .acceptEncodingHeader(<span class="string">"gzip, deflate"</span>)</div><div class="line">    .acceptLanguageHeader(<span class="string">"zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3"</span>)</div><div class="line">    .connection(<span class="string">"keep-alive"</span>)</div><div class="line">    .userAgentHeader(<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:23.0) Gecko/20100101 Firefox/23.0"</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_1 = <span class="type">Map</span>(<span class="string">""</span><span class="string">"Cache-Control"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"max-age=0"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_3 = <span class="type">Map</span>(<span class="string">""</span><span class="string">"Accept"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"text/css,*/*;q=0.1"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_4 = <span class="type">Map</span>(<span class="string">""</span><span class="string">"Accept"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"image/png,image/*;q=0.8,*/*;q=0.5"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_6 = <span class="type">Map</span>(<span class="string">""</span><span class="string">"Accept"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"*/*"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_8 = <span class="type">Map</span>(<span class="string">""</span><span class="string">"Content-Type"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"application/x-www-form-urlencoded"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_11 = <span class="type">Map</span>(</div><div class="line">    <span class="string">""</span><span class="string">"Accept"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"application/json, text/javascript, */*; q=0.01"</span><span class="string">""</span>,</div><div class="line">    <span class="string">""</span><span class="string">"X-Requested-With"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"XMLHttpRequest"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> scn = scenario(<span class="string">"Scenario Name"</span>)</div><div class="line">    .exec(http(<span class="string">"request_1"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/"</span><span class="string">""</span>)</div><div class="line">      .headers(headers_1))</div><div class="line">    .pause(<span class="number">2</span>)</div><div class="line">    .exec(http(<span class="string">"request_2"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/img/favicon.ico"</span><span class="string">""</span>))</div><div class="line">    .pause(<span class="number">648</span> milliseconds)</div><div class="line">    .exec(http(<span class="string">"request_3"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/gzip_N2030079394/bundles/all.css"</span><span class="string">""</span>)</div><div class="line">      .headers(headers_3))</div><div class="line">    .pause(<span class="number">819</span> milliseconds)</div><div class="line">    .exec(http(<span class="string">"request_4"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/cb1024132465/img/background.png"</span><span class="string">""</span>)</div><div class="line">      .headers(headers_4))</div><div class="line">    .pause(<span class="number">23</span> milliseconds)</div><div class="line">    .exec(http(<span class="string">"request_5"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/cb4077127084/img/small_window_content.png"</span><span class="string">""</span>)</div><div class="line">      .headers(headers_4))</div><div class="line">    .pause(<span class="number">2</span>)</div><div class="line">    .exec(http(<span class="string">"request_6"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/gzip_N762261864/bundles/all.js"</span><span class="string">""</span>)</div><div class="line">      .headers(headers_6))</div><div class="line">    .pause(<span class="number">1</span>)</div><div class="line">    .exec(http(<span class="string">"request_7"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/cb3761658453/img/sprite.png"</span><span class="string">""</span>)</div><div class="line">      .headers(headers_4))</div><div class="line">    .pause(<span class="number">30</span>)</div><div class="line">    .exec(http(<span class="string">"request_8"</span>)</div><div class="line">      .post(<span class="string">""</span><span class="string">"/login"</span><span class="string">""</span>)</div><div class="line">      .headers(headers_8)</div><div class="line">      .param(<span class="string">""</span><span class="string">"username"</span><span class="string">""</span>, <span class="string">""</span><span class="string">"user1"</span><span class="string">""</span>)</div><div class="line">      .param(<span class="string">""</span><span class="string">"password"</span><span class="string">""</span>, <span class="string">""</span><span class="string">"password1"</span><span class="string">""</span>))</div><div class="line">    .pause(<span class="number">3</span>)</div><div class="line">    .exec(http(<span class="string">"request_9"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/cb2545837452/img/big_window_content.png"</span><span class="string">""</span>)</div><div class="line">      .headers(headers_4))</div><div class="line">    .pause(<span class="number">21</span>)</div><div class="line">    .exec(http(<span class="string">"request_10"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/private/bank/account/ACC1/operations.html"</span><span class="string">""</span>))</div><div class="line">    .pause(<span class="number">3</span>)</div><div class="line">    .exec(http(<span class="string">"request_11"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/private/bank/account/ACC1/year/2012/month/4/page/0/operations.json"</span><span class="string">""</span>)</div><div class="line">      .headers(headers_11))</div><div class="line">    .pause(<span class="number">43</span>)</div><div class="line">    .exec(http(<span class="string">"request_12"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/private/bank/account/ACC1/year/2012/month/3/operations.html"</span><span class="string">""</span>))</div><div class="line">    .pause(<span class="number">663</span> milliseconds)</div><div class="line">    .exec(http(<span class="string">"request_13"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/private/bank/account/ACC1/year/2012/month/3/page/0/operations.json"</span><span class="string">""</span>)</div><div class="line">      .headers(headers_11))</div><div class="line">    .pause(<span class="number">4</span>)</div><div class="line">    .exec(http(<span class="string">"request_14"</span>)</div><div class="line">      .get(<span class="string">""</span><span class="string">"/logout"</span><span class="string">""</span>))</div><div class="line"></div><div class="line">  setUp(scn.inject(atOnce(<span class="number">1</span> user))).protocols(httpProtocol)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><p>MySimulation class 可以分为 4 部分：</p>
<ol>
<li>The HTTP protocol configuration</li>
<li>The headers definition</li>
<li>The scenario definition</li>
<li>The simulation definition</li>
</ol>
<p><em>The HTTP protocol configuration</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">val httpProtocol = http</div><div class="line">  .baseURL(&quot;http://excilysbank.gatling.cloudbees.net&quot;)</div><div class="line">  .acceptHeader(&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;)</div><div class="line">  .acceptEncodingHeader(&quot;gzip, deflate&quot;)</div><div class="line">  .acceptLanguageHeader(&quot;zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3&quot;)</div><div class="line">  .connection(&quot;keep-alive&quot;)</div><div class="line">  .userAgentHeader(&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:23.0) Gecko/20100101 Firefox/23.0&quot;)</div></pre></td></tr></table></figure>
<p>除了设置 http 协议之外，最重要的就是指定了 baseUrl</p>
<p><em>The headers definition</em></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> headers_1 = <span class="type">Map</span>(<span class="string">""</span><span class="string">"Cache-Control"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"max-age=0"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_3 = <span class="type">Map</span>(<span class="string">""</span><span class="string">"Accept"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"text/css,*/*;q=0.1"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_4 = <span class="type">Map</span>(<span class="string">""</span><span class="string">"Accept"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"image/png,image/*;q=0.8,*/*;q=0.5"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_6 = <span class="type">Map</span>(<span class="string">""</span><span class="string">"Accept"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"*/*"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_8 = <span class="type">Map</span>(<span class="string">""</span><span class="string">"Content-Type"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"application/x-www-form-urlencoded"</span><span class="string">""</span>)</div><div class="line"></div><div class="line">  <span class="keyword">val</span> headers_11 = <span class="type">Map</span>(</div><div class="line">    <span class="string">""</span><span class="string">"Accept"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"application/json, text/javascript, */*; q=0.01"</span><span class="string">""</span>,</div><div class="line">    <span class="string">""</span><span class="string">"X-Requested-With"</span><span class="string">""</span> -&gt; <span class="string">""</span><span class="string">"XMLHttpRequest"</span><span class="string">""</span>)</div></pre></td></tr></table></figure>
<p>每一个 header 都是一个 scala 的 Map。</p>
<blockquote>
<p>这些通用的 header 信息看上去没用，其实这些信息也额外增加了负载，也不容忽视的。</p>
</blockquote>
<p><em>The scenario definition</em></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> scn = scenario(<span class="string">"Scenario Name"</span>)</div><div class="line">  .exec(http(<span class="string">"request_1"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/"</span><span class="string">""</span>)</div><div class="line">    .headers(headers_1))</div><div class="line">  .pause(<span class="number">2</span>)</div><div class="line">  .exec(http(<span class="string">"request_2"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/img/favicon.ico"</span><span class="string">""</span>))</div><div class="line">  .pause(<span class="number">648</span> milliseconds)</div><div class="line">  .exec(http(<span class="string">"request_3"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/gzip_N2030079394/bundles/all.css"</span><span class="string">""</span>)</div><div class="line">    .headers(headers_3))</div><div class="line">  .pause(<span class="number">819</span> milliseconds)</div><div class="line">  .exec(http(<span class="string">"request_4"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/cb1024132465/img/background.png"</span><span class="string">""</span>)</div><div class="line">    .headers(headers_4))</div><div class="line">  .pause(<span class="number">23</span> milliseconds)</div><div class="line">  .exec(http(<span class="string">"request_5"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/cb4077127084/img/small_window_content.png"</span><span class="string">""</span>)</div><div class="line">    .headers(headers_4))</div><div class="line">  .pause(<span class="number">2</span>)</div><div class="line">  .exec(http(<span class="string">"request_6"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/gzip_N762261864/bundles/all.js"</span><span class="string">""</span>)</div><div class="line">    .headers(headers_6))</div><div class="line">  .pause(<span class="number">1</span>)</div><div class="line">  .exec(http(<span class="string">"request_7"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/cb3761658453/img/sprite.png"</span><span class="string">""</span>)</div><div class="line">    .headers(headers_4))</div><div class="line">  .pause(<span class="number">30</span>)</div><div class="line">  .exec(http(<span class="string">"request_8"</span>)</div><div class="line">    .post(<span class="string">""</span><span class="string">"/login"</span><span class="string">""</span>)</div><div class="line">    .headers(headers_8)</div><div class="line">    .param(<span class="string">""</span><span class="string">"username"</span><span class="string">""</span>, <span class="string">""</span><span class="string">"user1"</span><span class="string">""</span>)</div><div class="line">    .param(<span class="string">""</span><span class="string">"password"</span><span class="string">""</span>, <span class="string">""</span><span class="string">"password1"</span><span class="string">""</span>))</div><div class="line">  .pause(<span class="number">3</span>)</div><div class="line">  .exec(http(<span class="string">"request_9"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/cb2545837452/img/big_window_content.png"</span><span class="string">""</span>)</div><div class="line">    .headers(headers_4))</div><div class="line">  .pause(<span class="number">21</span>)</div><div class="line">  .exec(http(<span class="string">"request_10"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/private/bank/account/ACC1/operations.html"</span><span class="string">""</span>))</div><div class="line">  .pause(<span class="number">3</span>)</div><div class="line">  .exec(http(<span class="string">"request_11"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/private/bank/account/ACC1/year/2012/month/4/page/0/operations.json"</span><span class="string">""</span>)</div><div class="line">    .headers(headers_11))</div><div class="line">  .pause(<span class="number">43</span>)</div><div class="line">  .exec(http(<span class="string">"request_12"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/private/bank/account/ACC1/year/2012/month/3/operations.html"</span><span class="string">""</span>))</div><div class="line">  .pause(<span class="number">663</span> milliseconds)</div><div class="line">  .exec(http(<span class="string">"request_13"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/private/bank/account/ACC1/year/2012/month/3/page/0/operations.json"</span><span class="string">""</span>)</div><div class="line">    .headers(headers_11))</div><div class="line">  .pause(<span class="number">4</span>)</div><div class="line">  .exec(http(<span class="string">"request_14"</span>)</div><div class="line">    .get(<span class="string">""</span><span class="string">"/logout"</span><span class="string">""</span>))</div></pre></td></tr></table></figure>
<p>一个simluation 里面可以定义一个或者多个 scenario， 每个 scenario 是一个 scala 对象，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val scn = scenario(&quot;Name of my Scenario&quot;)...</div></pre></td></tr></table></figure>
<p>scenario 有两个方法：</p>
<ul>
<li>exec  - describe an action, usually a request sent to the tested application</li>
<li>pause - simulate the thinking time of the user between pages</li>
</ul>
<p>每个 scenario 里会发送很多个 request， 也会思考好多次。所以你看到上面的代码都是 exec http request 和 pause。</p>
<p>HTTP requests 的定义包括 名字，post 或者 get 方法，headers， 还有参数 :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">http(&quot;request_3&quot;)</div><div class="line">  .post(&quot;/login&quot;)</div><div class="line">  .headers(headers_3)</div><div class="line">  .param(&quot;username&quot;, &quot;user1&quot;)</div><div class="line">  .param(&quot;password&quot;, &quot;password1&quot;)</div></pre></td></tr></table></figure>
<p>这段代码会发送一个 POST 请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">POST http://excilysbank.gatling.cloudbees.net/login</div><div class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div><div class="line">Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7</div><div class="line">Accept-Encoding: gzip,deflate</div><div class="line">Accept-Language: fr,en-us;q=0.7,en;q=0.3</div><div class="line">Host: excilysbank.gatling.cloudbees.net</div><div class="line">Keep-Alive: 115</div><div class="line">User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.17) Gecko/20110422 Ubuntu/9.10 Firefox/3.6.17</div><div class="line">Content-Length: 33</div><div class="line">Content-Type: application/x-www-form-urlencoded</div><div class="line">Referer: http://excilysbank.gatling.cloudbees.net/public/login.html</div><div class="line"></div><div class="line">username=user1&amp;password=password1</div></pre></td></tr></table></figure>
<p><em>The simulation definition</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setUp(scn.inject(atOnce(1 user))).protocols(httpProtocol)</div></pre></td></tr></table></figure>
<h2 id="运行下吧！"><a href="#运行下吧！" class="headerlink" title="运行下吧！"></a>运行下吧！</h2><p>首先我们要把这个 Simulation move 到 user-files/simulations/下。</p>
<p>然后运行<code>$GATHING_HOME/bin/gatling.sh</code>, Gatling 会找到 MySimulation。</p>
<p><img src="/photos/run.png" alt=""></p>
<p>选择 MySimulation，一路回车，然后等待运行结束，生成 report：</p>
<p><img src="/photos/report.png" alt=""></p>
<h2 id="分析报表吧！"><a href="#分析报表吧！" class="headerlink" title="分析报表吧！"></a>分析报表吧！</h2><p>Gatling 生成的报表非常漂亮而且有意义。每个图表的具体含义可以参考 <a href="https://github.com/excilys/gatling/wiki/Reports" target="_blank" rel="external">Reports</a><br>这样子的报表几乎可以直接呈给领导，都不需要自己采集数据绘图了。</p>
<p><img src="/photos/gatling_report.png" alt=""></p>
<h1 id="下一节"><a href="#下一节" class="headerlink" title="下一节"></a>下一节</h1><p>到目前为止，我们都是照搬 Gatling wiki 来做的，其实就了解了下基本情况。下一节，应该搞个 project 试验下。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gatling/">gatling</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2013-08-29-add-hover-event-to-capybara" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/08/29/2013-08-29-add-hover-event-to-capybara/" class="article-date">
      <time datetime="2013-08-29T13:37:00.000Z" itemprop="datePublished">2013-08-29</time>
</a>

 
    <a href="/2013/08/29/2013-08-29-add-hover-event-to-capybara/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2013/08/29/2013-08-29-add-hover-event-to-capybara/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/29/2013-08-29-add-hover-event-to-capybara/">add hover event to capybara</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>Seems capybara has implemented the <code>hover</code> function</p>
<p>check <em><code>capybara/selenium/node.rb</code></em></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Capybara::Selenium::Node</span> &lt; Capybara::Driver::<span class="title">Node</span></span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">hover</span></span></div><div class="line">    driver.browser.action.move_to(native).perform</div><div class="line">  <span class="keyword">end</span></div><div class="line">...</div><div class="line"></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>But it’s only a selenium implementation. Not all the browsers implement <code>hover</code> function,<br>Capybara has not apply the method.</p>
<p>check <em><code>capybara/session.rb</code></em></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">NODE_METHODS = [</div><div class="line">  <span class="symbol">:all</span>, <span class="symbol">:first</span>, <span class="symbol">:attach_file</span>, <span class="symbol">:text</span>, <span class="symbol">:check</span>, <span class="symbol">:choose</span>,</div><div class="line">  <span class="symbol">:click_link_or_button</span>, <span class="symbol">:click_button</span>, <span class="symbol">:click_link</span>, <span class="symbol">:field_labeled</span>,</div><div class="line">  <span class="symbol">:fill_in</span>, <span class="symbol">:find</span>, <span class="symbol">:find_button</span>, <span class="symbol">:find_by_id</span>, <span class="symbol">:find_field</span>, <span class="symbol">:find_link</span>,</div><div class="line">  <span class="symbol">:has_content?</span>, <span class="symbol">:has_text?</span>, <span class="symbol">:has_css?</span>, <span class="symbol">:has_no_content?</span>, <span class="symbol">:has_no_text?</span>,</div><div class="line">  <span class="symbol">:has_no_css?</span>, <span class="symbol">:has_no_xpath?</span>, <span class="symbol">:resolve</span>, <span class="symbol">:has_xpath?</span>, <span class="symbol">:select</span>, <span class="symbol">:uncheck</span>,</div><div class="line">  <span class="symbol">:has_link?</span>, <span class="symbol">:has_no_link?</span>, <span class="symbol">:has_button?</span>, <span class="symbol">:has_no_button?</span>, <span class="symbol">:has_field?</span>,</div><div class="line">  <span class="symbol">:has_no_field?</span>, <span class="symbol">:has_checked_field?</span>, <span class="symbol">:has_unchecked_field?</span>,</div><div class="line">  <span class="symbol">:has_no_table?</span>, <span class="symbol">:has_table?</span>, <span class="symbol">:unselect</span>, <span class="symbol">:has_select?</span>, <span class="symbol">:has_no_select?</span>,</div><div class="line">  <span class="symbol">:has_selector?</span>, <span class="symbol">:has_no_selector?</span>, <span class="symbol">:click_on</span>, <span class="symbol">:has_no_checked_field?</span>,</div><div class="line">  <span class="symbol">:has_no_unchecked_field?</span>, <span class="symbol">:query</span>, <span class="symbol">:assert_selector</span>, <span class="symbol">:assert_no_selector</span></div><div class="line">]</div><div class="line">SESSION_METHODS = [</div><div class="line">  <span class="symbol">:body</span>, <span class="symbol">:html</span>, <span class="symbol">:source</span>, <span class="symbol">:current_url</span>, <span class="symbol">:current_host</span>, <span class="symbol">:current_path</span>,</div><div class="line">  <span class="symbol">:execute_script</span>, <span class="symbol">:evaluate_script</span>, <span class="symbol">:visit</span>,</div><div class="line">  <span class="symbol">:within</span>, <span class="symbol">:within_fieldset</span>, <span class="symbol">:within_table</span>, <span class="symbol">:within_frame</span>, <span class="symbol">:within_window</span>,</div><div class="line">  <span class="symbol">:save_page</span>, <span class="symbol">:save_and_open_page</span>, <span class="symbol">:save_screenshot</span>,</div><div class="line">  <span class="symbol">:reset_session!</span>, <span class="symbol">:response_headers</span>, <span class="symbol">:status_code</span>,</div><div class="line">  <span class="symbol">:title</span>, <span class="symbol">:has_title?</span>, <span class="symbol">:has_no_title?</span>, <span class="symbol">:current_scope</span></div><div class="line">]</div><div class="line">DSL_METHODS = NODE_METHODS + SESSION_METHODS</div></pre></td></tr></table></figure>
<p>You have two ways to use the hover function:</p>
<ol>
<li><p>convert element to selenium element and call hover</p>
<p><code>element.native.hover</code></p>
</li>
</ol>
<ol>
<li><p>Add the snippet below to <code>hook.rb</code> file under the support directory.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Example:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># find("span.assign").hover</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">Capybara</span></span></div><div class="line">  <span class="class"><span class="keyword">module</span> <span class="title">Node</span></span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Element</span></span></div><div class="line">      <span class="function"><span class="keyword">def</span> <span class="title">hover</span></span></div><div class="line">        @session.driver.browser.action.move_to(<span class="keyword">self</span>.native).perform</div><div class="line">      <span class="keyword">end</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/capybara/">capybara</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2013-08-25-du-lu-fan-yan-shi" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/08/25/2013-08-25-du-lu-fan-yan-shi/" class="article-date">
      <time datetime="2013-08-25T13:37:00.000Z" itemprop="datePublished">2013-08-25</time>
</a>

 
    <a href="/2013/08/25/2013-08-25-du-lu-fan-yan-shi/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2013/08/25/2013-08-25-du-lu-fan-yan-shi/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/25/2013-08-25-du-lu-fan-yan-shi/">读陆犯焉识</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <blockquote>
<p>妻子悄悄问：“他回来了吗？” 丈夫于是明白了，她打听的是她一直在等的那个人，虽然她已经忘了他的名字叫陆焉识。 “回来了。”丈夫悄悄地回答她。 “还来得及吗？”妻子又问。 “来得及的。他已经在路上了。” “哦，路很远的。” 婉喻最后这句话是袒护她的焉识；就是焉识来不及赶到也不是他的错，是路太远。</p>
</blockquote>
<p>不得不说严歌苓写人物很厉害，行云流水间，<br>把人物的一颦一笑展现在读者眼前，有时浓郁，有时淡雅。小姨多鹤如此，陆犯焉识也如此。</p>
<p>一口气把陆犯焉识读完，地铁上，马桶上，床上，然后不停的像身边人推荐，来读读看吧。<br>朋友会问有什么好的？ 说不上来，我不是一个擅长评价的人，特别是书籍电影之类的，<br>看完之后，常常就两个评价，好看。我一直以为一部好的作品，最大的作用就是加速无聊时间。<br>在地铁始发站，找个位置，然后开始读，没几章，目的地到了，心想还没看够呢。然后心满意足地继续看。</p>
<p>这总归是一本幸福的书，人们看事情，总是看一个头看一个尾，开头是幸福的，结尾是幸福的，所以<br>全部都是幸福的。失败的人才会把过程拿出来说事。陆焉识从没觉得过不开心，他最多觉得不自在，这是知识分子的臭老九。<br>女人的离开，好友的翻脸，政治的迫害，对他而言就是人生的一种经历，经过了，就留下幸福的回忆。到最后，婉喻去了，就剩下<br>老几在回忆。</p>
<p>这总归也是一本有关知识分子和政治的书。陆焉识的人生和政治碰撞交织融汇，知识分子的尊严碎了一地，自由的只有思维，<br>20 年的大西北出来了一个抖抖索索的老几，饶是如此，内心还是知识分子。给小孩们补课的时候，还不忘讽刺下毛主席。<br>谁对谁错呢？谁也不敢说，但我想陆焉识还是更适合美国。</p>
<p>这当然也是一本关于爱情的书，三段爱情，一段异国恋，两段婚外恋，还有一段异地恋。这段异地恋持续了 20 年，并越来越浓烈。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/读书笔记/">读书笔记</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/陆犯焉识/">陆犯焉识</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2013-08-21-wo-de-nexus-7-ruan-jian-lie-biao" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/08/21/2013-08-21-wo-de-nexus-7-ruan-jian-lie-biao/" class="article-date">
      <time datetime="2013-08-21T13:37:00.000Z" itemprop="datePublished">2013-08-21</time>
</a>

 
    <a href="/2013/08/21/2013-08-21-wo-de-nexus-7-ruan-jian-lie-biao/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2013/08/21/2013-08-21-wo-de-nexus-7-ruan-jian-lie-biao/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/21/2013-08-21-wo-de-nexus-7-ruan-jian-lie-biao/">我的 nexus 7 2013 软件列表</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>首先感谢<a href="http://weibo.com/u/1868904263" target="_blank" rel="external">小郭</a>，感谢美帝，没有你们，我就不会有 nexus 7 2013。<br>其实我一直想要台 Android 的平板，早在 2011 年的时候，当时同办公室的同事做 google image 测试，发了台 moto 的 xoom 做测试机，我就眼红不已。<br>在 2012 年的时候，我让<a href="http://weibo.com/dantawangzi" target="_blank" rel="external">小立</a>给我带过一个 nexus 7 2012， 结果被同事很喜欢，就转给他了。</p>
<p>可想而知： 一个人想得到一个平板，这其中需要无数的机缘巧合。</p>
<p>这台<em>奶骑</em>（网上人都这么叫-_-!），我拿到手差不多一个礼拜，<green>新买粪坑三天香</green>的热情也退了。中间装过无数软件，也卸载过无数软件，<br>也发现了几个问题。于是想总结下，一来以后自己可以用到，二来也和大家分享下。</p>
<p>###问题：</p>
<ol>
<li><p>外壳脆弱</p>
<p> nexus 7 2013 很轻很薄，所以显得特别柔弱，用力捏下，可以听见塑料的声响。当然塑料也很嫩，磕一下就一个小坑。</p>
</li>
<li><p>触屏失灵</p>
<p> 在国外网上看到的是，多点触摸有问题，会触发别的按键。这个我还没遇到，但是我遇到的是，触屏失灵，没有反应，在重新打开屏幕之后就恢复了。<br> 不确定是硬件还是软件的问题。</p>
</li>
<li><p>按钮生硬</p>
<p> 无论是电源按钮还是音量按钮，都硬的很，没有手感可言。</p>
</li>
<li><p>应用太少</p>
<p> HD 的应用实在太少了，相比苹果系列， Android 真是要加油啊！</p>
</li>
</ol>
<p>其实做为第一批， google 和 asus 做的还算不错啦， 虽然网上都说 google + asus = bad quality。</p>
<p>###应用：</p>
<ul>
<li><p>音乐视频：</p>
<ul>
<li>豆瓣FM</li>
<li>虾米音乐</li>
<li>MoboPlayer</li>
<li>MXPlayer (有广告)</li>
<li>快手看片</li>
<li>哗哩哗哩动画</li>
<li>PPTV HD</li>
<li>QQ 音乐 (我用的时候音乐断断续续过一次)</li>
</ul>
</li>
<li><p>阅读工具:</p>
<ul>
<li>多看阅读 (强烈推荐，买了好多书了。不过前面说到触屏失去反应也有可能是多看造成的。)</li>
<li>布卡漫画 (强烈推荐，宅男腐女必备)</li>
<li>Kindle</li>
<li>Adobe Reader</li>
<li>Flipboard</li>
<li>鲜果网</li>
<li>网易云阅读</li>
</ul>
</li>
<li><p>聊天社交：</p>
<ul>
<li>QQ hd</li>
<li>微信</li>
<li>Skype</li>
<li>豆果网</li>
<li>大众点评</li>
<li>weico 实在找不到好的微博的应用</li>
</ul>
</li>
<li><p>工具类：</p>
<ul>
<li>ES 文件浏览器 (强烈推荐)</li>
<li>爱壁纸 HD</li>
<li>有道词典</li>
<li>墨迹天气</li>
<li>金山快盘</li>
</ul>
</li>
<li><p>游戏：</p>
<ul>
<li>Doodle Fit2</li>
</ul>
</li>
</ul>
<p>以上应用如果不是指明 HD 的，基本就是矮子拔将军，但是效果不错哦！其实这些软件中有很多都有 HD 版本的，可惜都是一年半载不更新的那种，可惜了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>对我而言，平板的主要用途就是看书，看视频，相对而言上面的这些应用也足够了。当然这也是我一家之言，我也到底没有把所有的应用都体验过一把，所以希望有好用的，<br>请大力推给我</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nexus-7/">nexus 7</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2013-08-16-vim-cha-jian-tui-jian" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/08/16/2013-08-16-vim-cha-jian-tui-jian/" class="article-date">
      <time datetime="2013-08-16T13:37:00.000Z" itemprop="datePublished">2013-08-16</time>
</a>

 
    <a href="/2013/08/16/2013-08-16-vim-cha-jian-tui-jian/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2013/08/16/2013-08-16-vim-cha-jian-tui-jian/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/16/2013-08-16-vim-cha-jian-tui-jian/">vim 插件推荐</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>早上起来逛 <a href="http://ruby-china.org" target="_blank" rel="external">ruby china</a>， 看到 <a href="http://ruby-china.org/topics/13350" target="_blank" rel="external">vim 插件推荐</a>，进去一看果然有料。</p>
<ul>
<li>vim-easy-align</li>
<li>tcomment_vim</li>
</ul>
<p>果断把我的 tabular 和 nerdcommenter 替换掉。</p>
<h3 id="vim-easy-align"><a href="#vim-easy-align" class="headerlink" title="vim-easy-align"></a>vim-easy-align</h3><p>地址： <a href="https://github.com/junegunn/vim-easy-align" target="_blank" rel="external">https://github.com/junegunn/vim-easy-align</a></p>
<p><img src="/images/vim-easy-align.gif" alt=""></p>
<p>比任何一个对齐插件都简单啊，不愧是 <em>easy</em></p>
<h3 id="tcomment-vim"><a href="#tcomment-vim" class="headerlink" title="tcomment_vim"></a>tcomment_vim</h3><p>地址: <a href="https://github.com/tomtom/tcomment_vim" target="_blank" rel="external">https://github.com/tomtom/tcomment_vim</a></p>
<p>直接看介绍吧， <a href="http://vimsomnia.blogspot.com/2010/11/tcomment-vim-plugin.html" target="_blank" rel="external">http://vimsomnia.blogspot.com/2010/11/tcomment-vim-plugin.html</a></p>
<p>这是一个快速注释的插件，有自动识别文件类型(甚至是嵌套的类型)等的功能，感觉比 nerdcommenter 好很多</p>
<p>默认的快捷键是 <code>gcc</code>， 其实我就用那么一个。。。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/">vim</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2013-08-12-install-vim74-from-source" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/08/12/2013-08-12-install-vim74-from-source/" class="article-date">
      <time datetime="2013-08-12T13:37:00.000Z" itemprop="datePublished">2013-08-12</time>
</a>

 
    <a href="/2013/08/12/2013-08-12-install-vim74-from-source/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2013/08/12/2013-08-12-install-vim74-from-source/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/12/2013-08-12-install-vim74-from-source/">Install vim74 from source</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="Vim-7-4-released"><a href="#Vim-7-4-released" class="headerlink" title="Vim 7.4 released!"></a>Vim 7.4 released!</h2><p><img src="http://www.vim.org/images/vim_drill_small.JPG" alt=""></p>
<p>What are you waiting for?</p>
<hr>
<h3 id="install-vim7-4-for-mac"><a href="#install-vim7-4-for-mac" class="headerlink" title="install vim7.4 for mac"></a>install vim7.4 for mac</h3><p>HomeBrew has update the vim formula to the latest 7.4! woo!</p>
<p>See <a href="https://raw.github.com/mxcl/homebrew/master/Library/Formula/vim.rb" target="_blank" rel="external">vim.rb</a></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'formula'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vim</span> &lt; Formula</span></div><div class="line">  homepage <span class="string">'http://www.vim.org/'</span></div><div class="line">  <span class="comment"># Get the base 7.4 tarball from Vim.org. But once patches start again, go</span></div><div class="line">  <span class="comment"># back to tracking Debian unstable here:</span></div><div class="line">  <span class="comment"># http://ftp.de.debian.org/debian/pool/main/v/vim/</span></div><div class="line">  url <span class="string">'http://ftp.vim.org/pub/vim/unix/vim-7.4.tar.bz2'</span></div><div class="line">  sha1 <span class="string">'601abf7cc2b5ab186f40d8790e542f86afca86b7'</span></div><div class="line"></div><div class="line">  head <span class="string">'https://vim.googlecode.com/hg/'</span></div><div class="line"></div><div class="line">  <span class="comment"># We only have special support for finding depends_on :python, but not yet for</span></div><div class="line">  <span class="comment"># :ruby, :perl etc., so we use the standard environment that leaves the</span></div><div class="line">  <span class="comment"># PATH as the user has set it right now.</span></div><div class="line">  env <span class="symbol">:std</span></div><div class="line"></div><div class="line">  LANGUAGES         = <span class="string">%w(lua mzscheme perl python tcl ruby)</span></div><div class="line">  DEFAULT_LANGUAGES = <span class="string">%w(ruby python)</span></div><div class="line"></div><div class="line">  option <span class="string">"override-system-vi"</span>, <span class="string">"Override system vi"</span></div><div class="line">  option <span class="string">"disable-nls"</span>, <span class="string">"Build vim without National Language Support (translated messages, keymaps)"</span></div><div class="line"></div><div class="line">  LANGUAGES.each <span class="keyword">do</span> <span class="params">|language|</span></div><div class="line">    option <span class="string">"with-<span class="subst">#&#123;language&#125;</span>"</span>, <span class="string">"Build vim with <span class="subst">#&#123;language&#125;</span> support"</span></div><div class="line">    option <span class="string">"without-<span class="subst">#&#123;language&#125;</span>"</span>, <span class="string">"Build vim without <span class="subst">#&#123;language&#125;</span> support"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  depends_on <span class="symbol">:hg</span> =&gt; <span class="symbol">:build</span> <span class="keyword">if</span> build.head?</div><div class="line">  depends_on <span class="symbol">:python</span> =&gt; <span class="symbol">:recommended</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">install</span></span></div><div class="line">    ENV[<span class="string">'LUA_PREFIX'</span>] = HOMEBREW_PREFIX</div><div class="line"></div><div class="line">    language_opts = LANGUAGES.map <span class="keyword">do</span> <span class="params">|language|</span></div><div class="line">      <span class="keyword">if</span> DEFAULT_LANGUAGES.<span class="keyword">include</span>? language <span class="keyword">and</span> !build.<span class="keyword">include</span>? <span class="string">"without-<span class="subst">#&#123;language&#125;</span>"</span></div><div class="line">        <span class="string">"--enable-<span class="subst">#&#123;language&#125;</span>interp"</span></div><div class="line">      <span class="keyword">elsif</span> build.<span class="keyword">include</span>? <span class="string">"with-<span class="subst">#&#123;language&#125;</span>"</span></div><div class="line">        <span class="string">"--enable-<span class="subst">#&#123;language&#125;</span>interp"</span></div><div class="line">      <span class="keyword">end</span></div><div class="line">    <span class="keyword">end</span>.compact</div><div class="line"></div><div class="line">    opts = language_opts</div><div class="line">    opts &lt;&lt; <span class="string">"--disable-nls"</span> <span class="keyword">if</span> build.<span class="keyword">include</span>? <span class="string">"disable-nls"</span></div><div class="line"></div><div class="line">    <span class="comment"># Avoid that vim always links System's Python even if configure tells us</span></div><div class="line">    <span class="comment"># it has found a brewed Python. Verify with `otool -L`.</span></div><div class="line">    <span class="keyword">if</span> python &amp;&amp; python.brewed?</div><div class="line">      ENV.prepend <span class="string">'LDFLAGS'</span>, <span class="string">"-F<span class="subst">#&#123;python.framework&#125;</span>"</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    <span class="comment"># <span class="doctag">XXX:</span> Please do not submit a pull request that hardcodes the path</span></div><div class="line">    <span class="comment"># to ruby: vim can be compiled against 1.8.x or 1.9.3-p385 and up.</span></div><div class="line">    <span class="comment"># If you have problems with vim because of ruby, ensure a compatible</span></div><div class="line">    <span class="comment"># version is first in your PATH when building vim.</span></div><div class="line"></div><div class="line">    <span class="comment"># We specify HOMEBREW_PREFIX as the prefix to make vim look in the</span></div><div class="line">    <span class="comment"># the right place (HOMEBREW_PREFIX/share/vim/&#123;vimrc,vimfiles&#125;) for</span></div><div class="line">    <span class="comment"># system vimscript files. We specify the normal installation prefix</span></div><div class="line">    <span class="comment"># when calling "make install".</span></div><div class="line">    system <span class="string">"./configure"</span>, <span class="string">"--prefix=<span class="subst">#&#123;HOMEBREW_PREFIX&#125;</span>"</span>,</div><div class="line">                          <span class="string">"--mandir=<span class="subst">#&#123;man&#125;</span>"</span>,</div><div class="line">                          <span class="string">"--enable-gui=no"</span>,</div><div class="line">                          <span class="string">"--without-x"</span>,</div><div class="line">                          <span class="string">"--enable-multibyte"</span>,</div><div class="line">                          <span class="string">"--with-tlib=ncurses"</span>,</div><div class="line">                          <span class="string">"--enable-cscope"</span>,</div><div class="line">                          <span class="string">"--with-features=huge"</span>,</div><div class="line">                          <span class="string">"--with-compiledby=Homebrew"</span>,</div><div class="line">                          *opts</div><div class="line">    system <span class="string">"make"</span></div><div class="line">    <span class="comment"># If stripping the binaries is not enabled, vim will segfault with</span></div><div class="line">    <span class="comment"># statically-linked interpreters like ruby</span></div><div class="line">    <span class="comment"># http://code.google.com/p/vim/issues/detail?id=114&amp;thanks=114&amp;ts=1361483471</span></div><div class="line">    system <span class="string">"make"</span>, <span class="string">"install"</span>, <span class="string">"prefix=<span class="subst">#&#123;prefix&#125;</span>"</span>, <span class="string">"STRIP=/usr/bin/true"</span></div><div class="line">    ln_s bin+<span class="string">'vim'</span>, bin+<span class="string">'vi'</span> <span class="keyword">if</span> build.<span class="keyword">include</span>? <span class="string">'override-system-vi'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Just use</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install vim --with-python --with-ruby --with-perl --with-lua --with-tcl</div></pre></td></tr></table></figure>
<p>Wait or take a coffee break! And enjoy vim 7.4.</p>
<p>By the way, when you want to update brew but failed because of some formula you’ve editted which results in merge…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> `brew --prefix`</div><div class="line">git checkout .</div><div class="line">brew update</div></pre></td></tr></table></figure>
<hr>
<h3 id="install-vim7-4-for-ubuntu"><a href="#install-vim7-4-for-ubuntu" class="headerlink" title="install vim7.4 for ubuntu"></a>install vim7.4 for ubuntu</h3><p>A little complex but very easy!</p>
<ul>
<li>install the dependencies</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install libncurses5-dev libgnome2-dev libgnomeui-dev \</div><div class="line">libgtk2.0-dev libatk1.0-dev libbonoboui2-dev \</div><div class="line">libcairo2-dev libx11-dev libxpm-dev libxt-dev python-dev ruby-dev libperl-dev</div></pre></td></tr></table></figure>
<p>Note. I’m not very clear about the dependencies but <code>python-dev</code> <code>ruby-dev</code> <code>libperl-dev</code> are for python, ruby, perl interp.<br>For me, that’s enough.</p>
<ul>
<li>remove the old vim</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get remove vim vim-runtime gvim  vim-tiny vim-common vim-gui-common</div></pre></td></tr></table></figure>
<ul>
<li>download the source and compile to install</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">wget http://ftp.vim.org/pub/vim/unix/vim-7.4.tar.bz2</div><div class="line">tar xvf vim-7.4.tar.bz2</div><div class="line"><span class="built_in">cd</span> vim</div><div class="line"></div><div class="line">./configure \</div><div class="line">    --prefix=/usr \</div><div class="line">    --<span class="built_in">enable</span>-perlinterp=dynamic \</div><div class="line">    --<span class="built_in">enable</span>-pythoninterp \</div><div class="line">    --<span class="built_in">enable</span>-rubyinterp \</div><div class="line">    --<span class="built_in">enable</span>-luainterp=dynamic \</div><div class="line">    --<span class="built_in">enable</span>-cscope \</div><div class="line">    --<span class="built_in">enable</span>-gui=auto \</div><div class="line">    --<span class="built_in">enable</span>-gtk2-check \</div><div class="line">    --<span class="built_in">enable</span>-gnome-check \</div><div class="line">    --<span class="built_in">enable</span>-multibyte \</div><div class="line">    --<span class="built_in">enable</span>-fontset \</div><div class="line">    --with-features=huge \</div><div class="line">    --with-x \</div><div class="line">    --with-ruby-command=/usr/bin/ruby \</div><div class="line">    --with-compiledby=<span class="string">"Lihuazhang &lt;lihuazhang@hotmail.com&gt;"</span> \</div><div class="line">    --with-python-config-dir=/usr/lib/python2.7/config-x86_64-linux-gnu \</div><div class="line"></div><div class="line"><span class="comment"># --with-python3-config-dir=/usr/lib/python3.3/config-3.3m-x86_64-linux-gnu</span></div></pre></td></tr></table></figure>
<p>Wait for a seconds and <code>sudo make install</code> once the configure is compelted.</p>
<ul>
<li>set your vim  as your default editor</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># The prefix=/usr should be specified!</span></div><div class="line">sudo update-alternatives --install /usr/bin/editor editor /usr/bin/vim 1</div><div class="line">sudo update-alternatives --<span class="built_in">set</span> editor /usr/bin/vim</div><div class="line">sudo update-alternatives --install /usr/bin/vi vi /usr/bin/vim 1</div><div class="line">sudo update-alternatives --<span class="built_in">set</span> vi /usr/bin/vim</div></pre></td></tr></table></figure>
<p>Then done. Enjoy vim7.4.</p>
<hr>
<p>I have personally tested both installation.</p>
<p>If you have any question, please ping me. Or</p>
<p>Refer:</p>
<ol>
<li><a href="http://vim.wikia.com/wiki/Building_Vim" target="_blank" rel="external">http://vim.wikia.com/wiki/Building_Vim</a></li>
<li><a href="https://github.com/Valloric/YouCompleteMe/wiki/Building-Vim-from-source" target="_blank" rel="external">https://github.com/Valloric/YouCompleteMe/wiki/Building-Vim-from-source</a></li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/">vim</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2013-08-07-step-defintionshi-kong" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/08/07/2013-08-07-step-defintionshi-kong/" class="article-date">
      <time datetime="2013-08-07T13:37:00.000Z" itemprop="datePublished">2013-08-07</time>
</a>

 
    <a href="/2013/08/07/2013-08-07-step-defintionshi-kong/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2013/08/07/2013-08-07-step-defintionshi-kong/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/07/2013-08-07-step-defintionshi-kong/">由 step definition 失控引发的讨论和思考</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><p>公司在新项目上 BDD 的开发模式，迄今已经差不多 2 个月了。<br>按最初的分工，开发写 rspec， 测试写 cucumber，双线并行。<br>加上最新配置好的 jenkins ci 环境，整个开发流程走的很顺，<br>代码质量也得到了很好的控制。</p>
<p>今天按老样子写某个 component 的新加的feature的场景，<br>写 step definition 的时候，发现 stepdef.rb 文件已经<br>300 多行了。 瞬间有种再不控制就爆炸的感觉。</p>
<p>于是就把问题抛了出去：</p>
<blockquote>
<p>cucumber 的 step definition 爆了。。。 越写越多，真难控制！</p>
</blockquote>
<h2 id="讨论"><a href="#讨论" class="headerlink" title="讨论"></a>讨论</h2><p>我将问题抛在了 TestCirle 的群里，讨论地断断续续从下午一点到下午六点。我将每个人的发言总结下。</p>
<p><em>MIC-Seeyon</em></p>
<blockquote>
<p>step_definition 之上抽象一些 common function，再之上是 page object 的应用。<br>这样基本就封装了大部分逻辑了。这样就算 step_definition 再有多，也不会有多少代码吧～</p>
<p>如果有页面很多 ajax 操作，你可以把 ajax 的基础页写成 basePage，<br>然后其他的 ajax 业务写成不同的 page，继承 basePage 即可～</p>
<p>如果觉得实现太重的话，可以分工程，通用的抽取出来，其他的不同模块或者业务，基于这部分 common 的，搞自己的 feature，自己实现～<br>这样对具体的编码的人来说就轻了～</p>
<p>把握好 feature 的度, 整理一下测试用例的执行场景哦～</p>
<p>step definition 里面有太多冗余的东西的话就会很重，需要去冗。<br>如果有的话，那也得做一层基本的网页操作的抽象～<br>我是说业务和交互级别的 actions<br>比如根据 label 操作 input<br>各种条目的选择，操作，内容获取<br>这些可能都跟你产品的前段设计有关哦～</p>
<p>我们是这么做的：</p>
<ol>
<li>webdriver 的 api 操作封装一层</li>
<li>然后产品使用的前段控件封装一层</li>
<li>然后业务级别的逻辑跟操作封装一层</li>
<li>然后常用的操作组合封装一个层</li>
<li>最后才是 step definition</li>
</ol>
<p>cucumber就是一个驱动自动化测试的粘合剂</p>
</blockquote>
<p><em>横刀天笑</em></p>
<blockquote>
<p>逻辑肯定是在 page object 里的, page object 应该暴露业务接口，既然暴露业务接口，那肯定是包含业务逻辑的<br>比如我们酒店首页 HotelHomePage。有个搜索功能，那 肯定提供一个 search 的方法，search 里接受一个查询条件</p>
<p>page object，应该从用户角度来看，你这个页面提供了哪些功能,从业务功能上来看 po，而不是从操作上, 然后 step defs 里是流程的描述</p>
<p>持续交付里有一章讲自动化测试, 里面讲了一个三层:</p>
<ol>
<li>测试描述层(case)</li>
<li>测试实现层，或者叫流程层</li>
<li>应用接口层(比如使用 selenium 或 httpclient 之类的和应用程序打交道)</li>
</ol>
</blockquote>
<p><em>插曲 -_-!</em></p>
<blockquote>
<p>如何做一个能害死人的自动化测试工具<br><a href="http://www.ltesting.net/ceshi/ceshijishu/zdcs/2013/0806/206547.html?1375845711" target="_blank" rel="external">http://www.ltesting.net/ceshi/ceshijishu/zdcs/2013/0806/206547.html?1375845711</a></p>
</blockquote>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>我回想了下，这个项目一开始没采用 page object， 因为：</p>
<ol>
<li>以为项目不复杂，参考另一个公司 rails 项目的 cucumber features。</li>
<li>使用了 pickle，导致 feature 撰写的时候， 有过多的 code 色彩，如果使用 page object 的话 就有点混搭的感觉，不伦不类了。</li>
<li>最早之前用 page object 有些厌倦了。 特别 ajax render 的页面，导致继承 base 的页面过多。</li>
</ol>
<h3 id="关于第一点："><a href="#关于第一点：" class="headerlink" title="关于第一点："></a>关于第一点：</h3><p>接触过很多 rails 的项目， 往往是将 cucumber features 作为 High level 的 acceptance test， 挑选的场景的粒度都是比较粗。<br>而且 rails 项目的 cucumber 基本都是开发来写的，我一开始就把自己定位为开发。</p>
<h3 id="关于第二点："><a href="#关于第二点：" class="headerlink" title="关于第二点："></a>关于第二点：</h3><p><a href="https://github.com/ianwhite/pickle" target="_blank" rel="external">pickle</a> 非常强大</p>
<blockquote>
<p>Pickle gives you cucumber steps that create your models easily from<br>factory-girl, machinist, or fabrication. You can also just use ActiveRecord as a factory but it’s not as cool.</p>
</blockquote>
<p>但是使用 pickle 的前提是你必须了解 model， 了解各种 model 的 factory， 也就是其实你已经<br>是从开发的角度来考虑如何测试代码了。 你在 steps 里面的数据设计，其实都是你知道的结果，并不是测试出来的。</p>
<p>pickle 的使用，使 <code>Given</code>, <code>When</code> 和 <code>And</code> 对 测试和 stakeholder 不太友好。 这不像 page object 的风格。</p>
<h3 id="关于第三点"><a href="#关于第三点" class="headerlink" title="关于第三点"></a>关于第三点</h3><p>我在前面一个项目中应用了 <code>Page Object</code>， 我在博客里也粗略地介绍过， 参考 <a href="/categories.html#webdriver-ref">webdriver</a><br>由于我们项目大量使用 ajax， 导致基于 basePage 的子页面各种各样的特别多。个人感觉也不太舒服。</p>
<p>综上，所以一开始就忽略了 page object。</p>
<h3 id="目前"><a href="#目前" class="headerlink" title="目前"></a>目前</h3><p>我们现在仅仅把 features 进行了分类（利用目录结构），将所有的 step definition 都放在了一个 rb 文件里。随着以后的不同的场景，失控也是时间问题。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>目前看来， 这个项目的 cucumber 想要完成的是 <code>整个 UI 的自动化测试</code>。 要去冗，去重需要做的是：</p>
<ol>
<li>合并和参数化</li>
<li>Page Object</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cucumber/">cucumber</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2013-08-06-git-revert" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/08/06/2013-08-06-git-revert/" class="article-date">
      <time datetime="2013-08-06T13:37:00.000Z" itemprop="datePublished">2013-08-06</time>
</a>

 
    <a href="/2013/08/06/2013-08-06-git-revert/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2013/08/06/2013-08-06-git-revert/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/06/2013-08-06-git-revert/">git revert</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>最近一直在 github 上提交代码，所以总会遇到提交的代码 broken 了之前的 function。</p>
<blockquote>
<p>Perhaps you didn’t have enough coffee that morning, or it was just before lunch.</p>
</blockquote>
<p>其实这还无关紧要，再提交一个修复下就可以了。 但是也会遇到比较头疼的， 比如：</p>
<p><img src="/photos/git_graph_error.jpg" alt=""></p>
<p>注意蓝色这条线的 merge 那个点，开发同学因为粗心忘记把自动 merge 的代码提交了。<br>黑色这条线的同学，如果 pull 下来，就会发现一部分代码回到了蓝线的起点时候的状态。<br>然后呢，黑线这边的 merge 就会导致部分代码 rollback 了。很悲催吧。这个时候呢，提交修复也不太可能，最好的办法就是 <code>revert</code> 了。</p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p><code>git revert</code> 命令撤销一个 commit。它的做法是提交一个新的 commit， 这个 commit 里面将你要回滚的 commit 的修改全部撤销。<br>所以它不会破坏你的历史。如图所示：提交一个新的 commit （蓝球）， 撤销灰球修改。</p>
<p><img src="/photos/git-tutorial_changes-revert.png" alt=""></p>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git revert &lt;commit&gt;</div></pre></td></tr></table></figure>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p><a href="http://gitready.com/intermediate/2009/03/16/rolling-back-changes-with-revert.html" target="_blank" rel="external">http://gitready.com/intermediate/2009/03/16/rolling-back-changes-with-revert.html</a></p>
<p>假设我们有这样一个 git 历史：</p>
<p><img src="/photos/revert1.png" alt=""></p>
<p>我们来一次 revert</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git revert HEAD</div><div class="line">Finished one revert.</div><div class="line">[master]: created 1e689e2:</div><div class="line">  <span class="string">"Revert "</span>Updated to Rails 2.3.2 and edge hoptoad_notifier<span class="string">""</span></div></pre></td></tr></table></figure>
<p>revert 命令会自动帮你 commit， 并为你生成 commit 信息: Revert + 被回滚的 commit 的信息。<br>这里就是 “Revert “Updated to Rails 2.3.2 and edge hoptoad_notifier””</p>
<p>再来看下 revert 后的历史图：</p>
<p><img src="/photos/revert2.png" alt=""></p>
<p>可以看到 revert 的在最前面添加了一个 commit。</p>
<blockquote>
<p>By default using this command will bring up your $EDITOR so you can modify the commit message of the revert.<br>Use this to explain why the changes are being backed out!<br>If for some reason you don’t want to edit the commit message, tacking on <code>--no-edit</code> will allow you do so.</p>
</blockquote>
<p>另外如果你不想 commit 的话，还可以用 <code>-n</code> 参数</p>
<blockquote>
<p>Another helpful option is the -n or –no-commit flag.<br>This will simply leave the reverted changes in your working directory and not automatically commit them.<br>If you need to edit files further to complete the revert or possibly revert more than one commit, try out this option.</p>
</blockquote>
<p>接着，我们是试试看 revert 一个 merge 的 commit</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git revert HEAD~1</div><div class="line">fatal: Commit 137ea95 is a merge but no -m option was given.</div></pre></td></tr></table></figure>
<p>它告诉你 commit 137ea95 是一个 merge， 需要你指定一个 -m 的option。</p>
<blockquote>
<p>-m parent-number, –mainline parent-number<br>Usually you cannot revert a merge because you do not know which side of the merge should be considered the mainline.<br>This option specifies the parent number (starting from 1) of the mainline and allows revert to reverse the change relative to the specified parent.</p>
</blockquote>
<p>意思是，你需要指定一个 parent number （从1开始），然后 revert 会将基于这个 parent number 的改变都回滚。</p>
<p>再来看下 merge commit 的信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">log</span> HEAD~1 -1</div><div class="line">commit 137ea95c911633d3e908f6906e3adf6372cfb0ad</div><div class="line">Merge: 5f576a9... 62db4af...</div><div class="line">Author: Nick Quaranto &lt;nick@quaran.to&gt;</div><div class="line">Date:   Mon Mar 16 16:22:37 2009 -0400</div><div class="line"></div><div class="line">    Merging <span class="keyword">in</span> rails-2.3 branch</div></pre></td></tr></table></figure>
<p>可以看到 <code>5f576a9</code> 和 <code>62db4af</code> 被 merge 了。</p>
<p>所以</p>
<ol>
<li><code>git revert HEAD~1 -m 1</code> 就会 revert 基于 <code>5f576a9</code> 所发生的变化</li>
<li><code>git revert HEAD~1 -m 2</code> 就会 revert 基于 <code>62db4af</code> 所发生的变化  </li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ git revert HEAD~1 --no-edit --mainline 2</div><div class="line">Finished one revert.</div><div class="line">[master]: created 526b346: <span class="string">"Revert "</span>Merging <span class="keyword">in</span> rails-2.3 branch<span class="string">""</span></div><div class="line"></div><div class="line">$ git <span class="built_in">log</span> -1</div><div class="line">commit d64d3983845dfa18a5d935c7ac5a4855c125e474</div><div class="line">Author: Nick Quaranto &lt;nick@quaran.to&gt;</div><div class="line">Date:   Mon Mar 16 19:24:45 2009 -0400</div><div class="line"></div><div class="line">    Revert <span class="string">"Merging in rails-2.3 branch"</span></div><div class="line"></div><div class="line">    This reverts commit 137ea95c911633d3e908f6906e3adf6372cfb0ad, reversing</div><div class="line">    changes made to 62db4af8c77852d2cc9c19efc6dfb97e0d0067f5.</div></pre></td></tr></table></figure>
<p>很明确的告诉你， 这个 revert 提交了一个 commit： 137ea95c911633d3e908f6906e3adf6372cfb0ad，这个 commit 把 merge 操作对 62db4af8c77852d2cc9c19efc6dfb97e0d0067f5 发生的改变都回滚了。</p>
<h3 id="通俗说法"><a href="#通俗说法" class="headerlink" title="通俗说法"></a>通俗说法</h3><ol>
<li>普通的 revert： 比如桌上有一碗饭， 我吃完了，然后我又把这碗饭填满，像没吃一样， 填满的动作就是 revert。 看上去桌上的饭没有动过，但是事情其实发生了，就是历史没有被改变。</li>
<li>merge 的 revert：桌上有一碗饭，A 加了一道菜， B 加了一碗汤， merge 之后就是有饭有菜有汤。 现在在有饭有菜有汤的情况下去掉汤， 就是 <code>git revert &quot;commit of merge&quot; -m 菜</code>。</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2013-08-02-ba-yue-er-ri-gong-zuo-suo-shi" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/08/02/2013-08-02-ba-yue-er-ri-gong-zuo-suo-shi/" class="article-date">
      <time datetime="2013-08-02T13:37:00.000Z" itemprop="datePublished">2013-08-02</time>
</a>

 
    <a href="/2013/08/02/2013-08-02-ba-yue-er-ri-gong-zuo-suo-shi/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2013/08/02/2013-08-02-ba-yue-er-ri-gong-zuo-suo-shi/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/02/2013-08-02-ba-yue-er-ri-gong-zuo-suo-shi/">8-02-工作琐事</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="Xpath-Trap"><a href="#Xpath-Trap" class="headerlink" title="Xpath // Trap"></a>Xpath // Trap</h3><p>I am trying to loacte a attr element in a label context using capybara. The html looks like:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"post"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"post_name"</span>&gt;</span></div><div class="line">      Name<span class="tag">&lt;<span class="name">attr</span> <span class="attr">title</span>=<span class="string">"required"</span>&gt;</span>*<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure>
<p>And I use the code like:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">within <span class="string">"div.post"</span></div><div class="line"></div><div class="line">  label = page.find <span class="string">"label"</span>, <span class="string">"Name"</span></div><div class="line">  label.find <span class="symbol">:xpath</span>, <span class="string">"//attr[@title=\"required\"]"</span></div><div class="line"></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>As usual, I’m pretty sure that the find will work like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">//label//attr</div></pre></td></tr></table></figure>
<p>the find search the xpath in label context and find it.</p>
<p>Quite easy but I’m wrong.</p>
<p>In XPath the expression // means something very specific, and it might not be what you think.<br>Contrary to common belief, // means <red>anywhere in the document</red> not <red>anywhere in the current context</red>.<br>As an example:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">page.find(<span class="symbol">:xpath</span>, <span class="string">'//body'</span>).all(<span class="symbol">:xpath</span>, <span class="string">'//script'</span>)</div></pre></td></tr></table></figure>
<p>You might expect this to find all script tags in the body,<br>but actually, it finds all script tags in the entire document,<br>not only those in the body! What you’re looking for is the .// expression which means “any descendant of the current node”:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">page.find(<span class="symbol">:xpath</span>, <span class="string">'//body'</span>).all(<span class="symbol">:xpath</span>, <span class="string">'.//script'</span>)</div></pre></td></tr></table></figure>
<p>The same thing goes for within:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">within(<span class="symbol">:xpath</span>, <span class="string">'//body'</span>) <span class="keyword">do</span></div><div class="line">  page.find(<span class="symbol">:xpath</span>, <span class="string">'.//script'</span>)</div><div class="line">  within(<span class="symbol">:xpath</span>, <span class="string">'.//table/tbody'</span>) <span class="keyword">do</span></div><div class="line">  ...</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>You can refer to <a href="https://github.com/jnicklas/capybara" target="_blank" rel="external">capybara document</a></p>
<p>And also there is a great post: <a href="http://www.bennadel.com/blog/2142-Using-And-Expressions-In-XPath-XML-Search-Directives-In-ColdFusion.htm" target="_blank" rel="external">Using “//“ And “.//“ Expressions In XPath XML Search Directives In ColdFusion</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/capybara/">capybara</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2012-2017 恒温
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>


    

    
        <script id="dsq-count-scr" src="//8atmyhouse.disqus.com/count.js" async></script>
        <script>
            if ($(".left-col").is(":visible")) {
                var $disqusCount = $(".disqus-comment-count");
                $disqusCount.bind("DOMNodeInserted", function(e) {
                    var num = $(this).text().replace(/[^0-9]/ig,"");
                    if (num > 0) {
                        $(this).siblings(".count-comment").text(num);
                    }
                    $(this).remove();
                })
            } else {
                $(".disqus-comment-count").remove();
            }
        </script>
     




<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>